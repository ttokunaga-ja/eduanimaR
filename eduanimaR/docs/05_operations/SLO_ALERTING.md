# SLO / Alerting（Frontend）

このドキュメントは、フロントエンドのSLOとアラートの最小セットを固定します。

目的：
- “壊れているのに気づけない” をなくす
- リリース前後の劣化検知を可能にする

関連：
- 観測性：`OBSERVABILITY.md`
- リリース：`RELEASE.md`

---

## 結論（Must）

- SLO は「対象ページ」と「指標」を固定してから運用する
- 重大障害は “即検知” が必要（エラー率/5xx/ログイン不可など）
- パフォーマンス劣化は “傾向検知” で良い（Vitals）

---

## 用語（Must）

- **SLI**（Service Level Indicator）: 観測する指標（例：成功率、レイテンシ、LCP）
- **SLO**（Service Level Objective）: 目標（例：30日成功率 99.9%）
- **Error Budget**: 許容できる失敗の枠（SLO 未達の余地）。消費が速いときはアラートの優先度を上げる

---

## 1) SLO（テンプレ）

SLO は「対象（ユーザー導線/ページ）」と「SLI（何を成功/失敗とするか）」を先に固定してから運用します。

### 1.1 対象（推奨）

- Top / 検索 / 購入 / 設定 / ログイン など、**ユーザー影響が大きい導線**に絞る
- “全ページ一律” で始めない（計測コストとノイズが増える）

### 1.2 SLI の例（最小）

- **画面表示成功率**: 主要ページの表示が完了し、error boundary に落ちていない割合
- **API 成功率（BFF）**: 主要 API の成功率（HTTP 5xx を失敗として扱う等）
- **レイテンシ**: p95（RUM の LCP/INP、BFF のレスポンスレイテンシ）

### 1.3 テンプレ（プロジェクトで埋める）

| 対象 | SLI | 期間 | SLO | 計測元 | アラート種別 |
|---|---|---|---|---|---|
| ログイン | 画面表示成功率 | 30日 | 99.9% | RUM | 即時 |
| 購入 | API 成功率（5xx） | 30日 | 99.9% | BFF | 即時 |
| 検索 | p95 レイテンシ | 7日 | < X ms | BFF | 即時/傾向 |
| Top | LCP（p75） | 7日 | < 2.5s | RUM | 傾向 |

注記：
- 数値（SLO/閾値）は、UX/収益/法令/サポート体制で決める（“良さそう”で固定しない）
- RUM と BFF の指標を混ぜない（原因追跡が困難になる）

---

## 2) 最小アラート（テンプレ）

即時（ページャ/通知）：
- 5xx 急増（BFF/Route Handler）
- ログイン不可/認証ループ
- 主要 API の失敗率急増

傾向（チケット/通知）：
- LCP/INP がしきい値を超過
- JSエラー率の増加

---

## 2.1 アラート設計（Must）

- **症状アラート**（ページャ/即時）：ユーザー影響を直接示す（成功率低下、ログイン不可、購入失敗、5xx 急増）
- **原因候補アラート**（通知/チケット）：復旧の手掛かり（依存先のタイムアウト、特定リリース以降の例外急増）

### Error Budget / Burn-rate（概要）

- Error Budget の消費速度が速いときは、短い窓と長い窓を組み合わせて通知する
- 例（考え方のみ。具体値はプロジェクトで統一）：
  - 速い窓（5〜30分）: “今すぐ壊れている” を検知
  - 遅い窓（6〜24時間）: “じわじわ悪化” を検知

---

## 3) Runbook（最低限）

アラートごとに最低限書く：
- 影響（どのユーザー/導線か）
- 直近リリース
- 切り分け手順（RUM → BFF → upstream）
- ロールバック手順（`RELEASE.md`）

推奨（最低限の運用情報）：
- オーナー（担当チーム）
- 通知先（Slack チャンネル等）
- エスカレーション（営業時間/オンコール）

---

## 禁止（AI/人間共通）

- SLO/しきい値無しでアラートを増やす（ノイズ化する）
- “見てるつもり” で計測未導入
