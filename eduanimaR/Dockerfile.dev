# Dockerfile.dev
# Next.js 15 開発サーバー（ホットリロード / Fast Refresh）
# 使用方法: docker compose --profile dev up --build
#
# 本番用は Dockerfile を使用すること

FROM node:22-alpine

# libc 互換レイヤー（sharp 等 native モジュール用）
RUN apk add --no-cache libc6-compat

WORKDIR /app

# package.json と lock ファイルをコピーして依存インストール
# ソースはボリュームマウントするため node_modules のみここでインストール
COPY package.json package-lock.json ./

RUN npm ci

# 環境変数
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
# ブラウザから直接アクセスする API URL（ホスト側の professor）
ENV NEXT_PUBLIC_API_BASE_URL=http://localhost:8080/api
# サーバーサイド（RSC / Route Handler）から Docker ネットワーク内の professor へ
ENV API_BASE_URL=http://professor-dev:8080/api

EXPOSE 3000

# Next.js dev server（Fast Refresh 有効、全ネットワークインターフェース待受）
CMD ["npm", "run", "dev", "--", "--hostname", "0.0.0.0"]
